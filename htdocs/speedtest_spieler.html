<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<script type="text/javascript" src="src/Casino/Besucher.js"></script>
		<script type="text/javascript" src="src/Casino/Spieler.js"></script>
		<script type="text/javascript" src="src/Casino/Croupier.js"></script>
		<script language="javascript" type="text/javascript">
			var SPIELER_ID = window.location.search.substr(1, window.location.search.length);
			var GEHEIME_SPIELER_ID = window.location.search.substr(1, window.location.search.length);
			var TISCH_ID = 'GrafZahl';
			var spieler = null;
			
			document.addEventListener("load", init, false);
			document.addEventListener("DOMContentLoaded", init, false);
			
			function init() {
				window.i = 0;
				window.anfragenZaehler = 0;
				window.anfragenStartZeit = new Date().getTime();
				document.getElementsByTagName('input')[0].value = '';
				
				spieler = new CasinoSpieler(SPIELER_ID, GEHEIME_SPIELER_ID);
				spieler.derCroupierFragt = spiele;
				spieler.betrete("ws://10.1.1.198:8080/", function() {
					warteAufTisch();
				});
			}
			// FLOAT
			function errechneGeschwindigkeit() {
				var zeitRaum = new Date().getTime() - window.anfragenStartZeit;
				var anfragenProSekunde = window.anfragenZaehler / (zeitRaum / 1000);
				window.anfragenZaehler = 0;
				window.anfragenStartZeit = new Date().getTime();
				return anfragenProSekunde;
			}
			function spiele(frage) {
				window.anfragenZaehler++;
				logge('spiele');
				this._antworteDemCroupier(frage + 1);
			};
			function warteAufTisch() {
				logge('warte auf Tisch "' + TISCH_ID + '"...');
				spieler.zeigeOffeneTische(function(liste) {
					for(var i = 0; i < liste.length;i++) {
						if(liste[i].tischId == TISCH_ID) {
							logge("Tisch betreten...");
							spieler.spieleAnTisch(TISCH_ID, function() {
								if(spieler.spieltAnTisch) {
									logge("Spielen:");
									return;
									
								} else {
									setTimeout('warteAufTisch()', 1000);
								}
							});
							return;
						}
					}
					setTimeout('warteAufTisch()', 1000);
				});
			}
			function logge(msg, error) {
				window.i++;
				if(window.i > 432 || error) {
					document.getElementsByTagName('input')[0].value = msg + '(v = ' + errechneGeschwindigkeit() + ' PingPong/s)';
					window.i = 0;
				}
			}
		</script>
	</head>
	<body><input type="text" style="width: 100%;"/></body>
</html>