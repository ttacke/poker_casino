<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<script type="text/javascript" src="src/Casino/Besucher.js"></script>
		<script type="text/javascript" src="src/Casino/Spieler.js"></script>
		<script type="text/javascript" src="src/Casino/Croupier.js"></script>
		<script language="javascript" type="text/javascript">
			var SPIELER_NAME = window.location.search.substr(1, window.location.search.length);
			var SPIELER_PASSWORT = window.location.search.substr(1, window.location.search.length);
			var TISCH_NAME = 'GrafZahl';
			var spieler = null;
			
			document.addEventListener("load", init, false);
			document.addEventListener("DOMContentLoaded", init, false);
			
			function init() {
				window.i = 0;
				window.anfragenZaehler = 0;
				window.anfragenStartZeit = new Date().getTime();
				document.getElementsByTagName('input')[0].value = '';
				
				spieler = new CasinoSpieler(SPIELER_NAME, SPIELER_PASSWORT);
				spieler.derCroupierFragt = function(frage) {
					window.anfragenZaehler++;
					logge('spiele');
					this._antworteDemCroupier((frage * 1) + 1);
				};
				spieler.betrete("ws://10.1.6.150:8080/", function() {
					warteAufTisch();
				});
			}
			// FLOAT
			function errechneGeschwindigkeit() {
				var zeitRaum = new Date().getTime() - window.anfragenStartZeit;
				var anfragenProSekunde = window.anfragenZaehler / (zeitRaum / 1000);
				window.anfragenZaehler = 0;
				window.anfragenStartZeit = new Date().getTime();
				return anfragenProSekunde;
			}
			function warteAufTisch() {
				logge('warte auf Tisch "' + TISCH_NAME + '"...', true);
				spieler.zeigeOffeneTische(function(antwort) {
					var liste = antwort.details;
					for(var i = 0; i < liste.length;i++) {
						if(liste[i].tischName == TISCH_NAME) {
							logge("Tisch betreten...", true);
							spieler.spieleAnTisch(TISCH_NAME, function(antwort) {
								if(antwort.status == 'ok') {
									logge("Spielen:", true);
									return;
									
								} else {
									setTimeout('warteAufTisch()', 1000);
								}
							});
							return;
						}
					}
					setTimeout('warteAufTisch()', 1000);
				});
			}
			function logge(msg, zeigeDirekt) {
				window.i++;
				if(window.i > 432 || zeigeDirekt) {
					document.getElementsByTagName('input')[0].value = msg + '(v = ' + errechneGeschwindigkeit() + ' PingPong/s)';
					window.i = 0;
				}
			}
		</script>
	</head>
	<body><input type="text" style="width: 100%;"/></body>
</html>