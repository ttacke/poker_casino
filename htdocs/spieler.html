<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<script type="text/javascript" src="src/Casino/Besucher.js"></script>
		<script type="text/javascript" src="src/Casino/Spieler.js"></script>
		<script type="text/javascript" src="src/Casino/Croupier.js"></script>
		<script language="javascript" type="text/javascript">
			var SPIELER_ID = window.location.search.substr(1, window.location.search.length);
			var GEHEIME_SPIELER_ID = window.location.search.substr(1, window.location.search.length);
			var TISCH_ID = 'GrafZahl';
			var spieler = null;
			
			document.addEventListener("load", init, false);
			document.addEventListener("DOMContentLoaded", init, false);

			function init() {
				window.i = 0;
				document.getElementsByTagName('textarea')[0].value = '';
				
				spieler = new CasinoSpieler(SPIELER_ID, GEHEIME_SPIELER_ID);
				spieler.derCroupierFragt = spiele;
				spieler.betrete("ws://localhost:8080/", function() {
					warteAufTisch();
				});
			}
			function spiele(frage) {
				logge(frage + ' + 1 = ' + (frage + 1));
				this._antworteDemCroupier(frage + 1);
			};
			function warteAufTisch() {
				logge('warte auf Tisch "' + TISCH_ID + '"...');
				spieler.zeigeOffeneTische(function(liste) {
					for(var i = 0; i < liste.length;i++) {
						if(liste[i].tischId == TISCH_ID) {
							logge("Tisch betreten...");
							spieler.spieleAnTisch(TISCH_ID, function() {
								if(spieler.spieltAnTisch) {
									logge("Spielen:");
									return;
									
								} else {
									setTimeout('warteAufTisch()', 1000);
								}
							});
							return;
						}
					}
					setTimeout('warteAufTisch()', 1000);
				});
			}
			function logge(msg) {
				var old = document.getElementsByTagName('textarea')[0].value.substr(0, 1000);
				document.getElementsByTagName('textarea')[0].value = (++window.i) + ' ' + msg + "\n" + old;
			}
		</script>
	</head>
	<body><textarea style="width: 100%;height: 200px;"></textarea></body>
</html>